<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="ConserVapp">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#0f172a" />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="assets/icons/icon-192.png" />
  <title>Fiscaliza - Login</title>
  <script defer src="js/login.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white min-h-screen flex items-center justify-center">

<main class="w-full max-w-xs px-5 py-6 bg-slate-800 rounded-2xl shadow-xl border border-slate-700">
  <div class="text-center mb-5">
    <img src="assets/icons/icon-192.png" alt="Logo Fiscaliza" class="w-16 h-16 mx-auto rounded-xl shadow">
    <h1 class="text-xl font-bold mt-3 text-white">ConservApp 23ª GC</h1>
    <p class="text-slate-400 text-xs mt-1">Prefeitura do Rio</p>
  </div>

  <!-- FORMULÁRIO DE LOGIN -->
  <form id="loginForm" class="space-y-4 text-sm" autocomplete="off">
    <div>
      <label for="usuario" class="block font-medium text-white mb-1">Usuário</label>
      <input type="text" id="usuario" name="usuario" required autofocus
        autocomplete="off" inputmode="verbatim"
        class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 placeholder-slate-400"
        placeholder="Digite seu usuário" />
    </div>

    <div>
      <label for="senha" class="block font-medium text-white mb-1">Senha</label>
      <input type="password" id="senha" name="senha" required autocomplete="new-password"
        class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 placeholder-slate-400"
        placeholder="Digite sua senha" />
      <div class="flex items-center">
        <input type="checkbox" id="lembrar" name="lembrar" class="mr-2">
        <label for="lembrar" class="text-sm text-slate-300">Manter-me conectado</label>
      </div>
    </div>

    <button type="submit"
      class="w-full bg-cyan-600 hover:bg-cyan-700 transition px-4 py-2 rounded-lg font-semibold text-white shadow">
      Entrar
    </button>

    <p id="erroLogin" class="text-red-400 text-xs text-center hidden mt-2">Usuário ou senha inválidos.</p>
  </form>
</main>

<!-- Modal de Instalação (Android) -->
<div id="modalPWA" class="hidden fixed bottom-4 left-1/2 -translate-x-1/2 w-[90%] max-w-sm bg-white text-slate-800 rounded-xl shadow-lg p-4 z-50 animate-slideup">
  <button id="fecharPWA"
    class="absolute top-2 right-3 text-xl font-bold text-slate-500 hover:text-slate-900 transition-colors">&times;</button>
  <div class="text-center">
    <p class="text-sm mb-3">Deseja instalar o aplicativo <strong>Fiscaliza 23ª GC</strong>?</p>
    <button id="btnInstalar"
      class="w-full flex items-center justify-center gap-2 bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded-lg font-bold transition">
      <i class="fas fa-download"></i> Instalar App
    </button>
  </div>
</div>

<!-- Banner iOS -->
<div id="iosBanner" class="hidden fixed bottom-4 left-1/2 -translate-x-1/2 w-[90%] max-w-sm bg-yellow-100 text-slate-900 rounded-xl shadow-lg p-4 z-50 animate-slideup text-sm">
  <div class="flex justify-between items-start">
    <div>
      <p class="font-semibold mb-1">Instalar o app</p>
      <p>Para instalar este app, toque em <strong>Compartilhar</strong> 📤 e depois <strong>“Adicionar à Tela de Início”</strong>.</p>
    </div>
    <button id="fecharIosBanner" class="text-xl font-bold text-slate-600 hover:text-slate-900 ml-4">&times;</button>
  </div>
</div>

<style>
  @keyframes slideup {
    from {
      transform: translate(-50%, 100%);
      opacity: 0;
    }
    to {
      transform: translate(-50%, 0);
      opacity: 1;
    }
  }
  .animate-slideup {
    animation: slideup 0.4s ease-out forwards;
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js"></script>
<script>
  let deferredPrompt;

  function isIos() {
    return /iPhone|iPad|iPod/.test(navigator.userAgent);
  }

  window.addEventListener('load', () => {
    if (isIos() && !window.matchMedia('(display-mode: standalone)').matches) {
      setTimeout(() => {
        document.getElementById('iosBanner').classList.remove('hidden');
      }, 4000);
    }
  });

  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;

    setTimeout(() => {
      if (!window.matchMedia('(display-mode: standalone)').matches && !isIos()) {
        document.getElementById('modalPWA').classList.remove('hidden');
      }
    }, 3000);
  });

  document.getElementById('btnInstalar').addEventListener('click', () => {
    document.getElementById('modalPWA').classList.add('hidden');
    if (deferredPrompt) {
      deferredPrompt.prompt();
      deferredPrompt.userChoice.then(choice => {
        console.log('Usuário escolheu:', choice.outcome);
        deferredPrompt = null;
      });
    }
  });

  document.getElementById('fecharPWA').addEventListener('click', () => {
    document.getElementById('modalPWA').classList.add('hidden');
  });

  document.getElementById('fecharIosBanner').addEventListener('click', () => {
    document.getElementById('iosBanner').classList.add('hidden');
  });
</script>
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/pro/service-worker.js')
      .then(reg => console.log('✅ Service Worker registrado:', reg))
      .catch(err => console.error('❌ Erro ao registrar SW:', err));
  }

  if (window.matchMedia('(display-mode: standalone)').matches) {
    console.log('✅ Modo standalone ativo');
  } else {
    console.log('⚠️ Ainda rodando como navegador');
  }
</script>

</body>
</html>